import React, { useState } from 'react';

const App = () => {
  const [activeTab, setActiveTab] = useState('home');
  const [device, setDevice] = useState('android');
  const [showDeviceSelection, setShowDeviceSelection] = useState(false);
  const [buyStep, setBuyStep] = useState(1);
  const [selectedTariff, setSelectedTariff] = useState(null);
  const [selectedServer, setSelectedServer] = useState(null);

  const configs = [
    { id: 1, protocol: 'VLESS', expiry: '2026-03-15', server: 'Amsterdam', status: 'active' },
    { id: 2, protocol: 'Trojan', expiry: '2026-04-20', server: 'Singapore', status: 'active' }
  ];

  const tariffs = [
    { id: 1, days: 30, price: 199, currency: '₽', speed: 'до 1 Gbps' },
    { id: 2, days: 90, price: 499, currency: '₽', speed: 'до 1 Gbps' },
    { id: 3, days: 365, price: 1499, currency: '₽', speed: 'до 1 Gbps' }
  ];

  const servers = [
    { id: 1, name: 'Amsterdam', country: 'Netherlands', latency: '18 ms' },
    { id: 2, name: 'Singapore', country: 'Singapore', latency: '42 ms' },
    { id: 3, name: 'New York', country: 'USA', latency: '76 ms' },
    { id: 4, name: 'Tokyo', country: 'Japan', latency: '51 ms' }
  ];

  const deviceOptions = [
    { id: 'android', name: 'Android', icon: 'android' },
    { id: 'ios', name: 'iOS', icon: 'apple' },
    { id: 'windows', name: 'Windows', icon: 'windows' }
  ];

  const handleConnect = (config) => {
    if (device === 'windows') {
      alert('Следуйте инструкции по настройке Windows VPN');
    } else {
      alert(`Подключение к ${config.protocol} на ${config.server}`);
    }
  };

  const handleBuy = (tariff) => {
    setSelectedTariff(tariff);
    setBuyStep(2);
  };

  const handleSelectServer = (server) => {
    setSelectedServer(server);
    setBuyStep(3);
  };

  /* Иконки устройств: Android, Apple, Windows */
  const IconDevice = ({ type, size = 24 }) => {
    const s = size;
    if (type === 'android') {
      return (
        <svg {...svgProps}>
          <path d="M17.6 9.48l1.84-3.18c.16-.31.04-.69-.26-.85-.29-.15-.65-.06-.83.22l-1.88 3.24c-1.41-.52-2.99-.8-4.66-.8-1.67 0-3.25.28-4.66.8L5.65 5.67c-.19-.28-.54-.37-.83-.22-.3.16-.42.54-.26.85L6.4 9.48C3.3 11.25 1.28 14.44 1 18h22c-.28-3.56-2.3-6.75-5.4-8.52zM7 15.25c-.69 0-1.25-.56-1.25-1.25S6.31 12.75 7 12.75 8.25 13.31 8.25 14 7.69 15.25 7 15.25zm10 0c-.69 0-1.25-.56-1.25-1.25s.56-1.25 1.25-1.25 1.25.56 1.25 1.25-.56 1.25-1.25 1.25z"/>
        </svg>
      );
    }
    if (type === 'apple') {
      return (
        <svg width={s} height={s} viewBox="0 0 24 24" fill="currentColor" className="shrink-0">
          <path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
        </svg>
      );
    }
    if (type === 'windows') {
      return (
        <svg width={s} height={s} viewBox="0 0 24 24" fill="currentColor" className="shrink-0">
          <path d="M3 5.5L10.5 4v8L3 11.5V5.5zM11 4l10-1.5v8l-10 .5V4zM3 12.5l7.5.5v8L3 19.5v-7zm8 .5l10 1v8l-10-1.5V13z"/>
        </svg>
      );
    }
    return null;
  };

  const IconConnect = () => (
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path d="M12 2L15.5 12H22L15.5 22H12L8.5 12H2L8.5 2Z" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
    </svg>
  );

  const IconServer = () => (
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="12" r="8" stroke="currentColor" strokeWidth="1.5"/>
      <path d="M12 8V4M12 20V16M8 12H4M20 12H16" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
    </svg>
  );

  const IconBalance = () => (
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="1.5"/>
      <path d="M12 8V16M8 12H16" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
    </svg>
  );

  const IconReferral = () => (
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="8" r="3" stroke="currentColor" strokeWidth="1.5"/>
      <path d="M4 20c0-4 4-6 8-6s8 2 8 6" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
    </svg>
  );

  const IconTariff = () => (
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" strokeWidth="1.5"/>
      <path d="M8 8H16M8 12H16M8 16H16" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
    </svg>
  );

  const IconArrowRight = () => (
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
      <path d="M14 5L21 12L14 19" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
    </svg>
  );

  const IconCheck = () => (
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
      <path d="M5 13L10 18L20 7" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
    </svg>
  );

  const IconRefresh = () => (
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
      <path d="M21 12a9 9 0 11-2.636-6.364M21 3v6h-6" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
    </svg>
  );

  /* UI-стиль: тёмная база, карточки, скругления, голубой акцент */
  const Card = ({ children, className = "" }) => (
    <div className={`rounded-2xl p-5 bg-[#16161a] border border-[#2a2a32] shadow-[0_4px_24px_rgba(0,0,0,0.35)] ${className}`}>
      {children}
    </div>
  );

  const renderHome = () => (
    <div className="space-y-6">
      <div className="text-center">
        <h1 className="text-2xl font-bold tracking-tight mb-3 text-white">VPN Shield</h1>
        <div className="inline-flex items-center gap-3 bg-[#16161a] border border-[#2a2a32] rounded-2xl px-5 py-3">
          <div className="w-10 h-10 rounded-xl bg-[#1e1e24] flex items-center justify-center text-[#4fc3f7]">
            <IconDevice type={device} size={24} />
          </div>
          <span className="text-[#a0a0c0] text-sm font-medium">
            {device === 'android' ? 'Android' : device === 'ios' ? 'iOS' : 'Windows'}
          </span>
        </div>
      </div>

      <button
        onClick={() => setShowDeviceSelection(true)}
        className="w-full py-4 bg-[#16161a] hover:bg-[#1e1e24] border border-[#2a2a32] rounded-2xl text-[#e0e0e8] transition-all flex items-center justify-center gap-3"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" className="text-[#4fc3f7]">
          <circle cx="12" cy="12" r="9" stroke="currentColor" strokeWidth="1.5"/>
          <path d="M12 8v4l2 2" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
        </svg>
        <span>Изменить устройство</span>
      </button>

      <div className="space-y-3">
        {[
          { title: 'Мои конфиги', desc: 'Управление подключениями', icon: IconConnect, action: () => setActiveTab('configs') },
          { title: 'Купить VPN', desc: 'Безлимитный трафик', icon: IconTariff, action: () => setActiveTab('buy') },
          { title: 'Профиль', desc: 'Баланс и рефералы', icon: IconReferral, action: () => setActiveTab('profile') }
        ].map((item, i) => (
          <Card key={i} className="cursor-pointer hover:border-[#3a3a44] transition-colors" onClick={item.action}>
            <div className="flex justify-between items-center">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-[#1e1e24] flex items-center justify-center text-[#4fc3f7]">
                  <item.icon />
                </div>
                <div>
                  <h3 className="text-lg font-bold text-white">{item.title}</h3>
                  <p className="text-[#8888a0] text-sm">{item.desc}</p>
                </div>
              </div>
              <IconArrowRight className="text-[#4fc3f7]" />
            </div>
          </Card>
        ))}
      </div>
    </div>
  );

  const renderConfigs = () => (
    <div className="space-y-4">
      <h2 className="text-xl font-bold text-white mb-4">Мои конфиги</h2>
      {configs.length === 0 ? (
        <Card className="text-center py-12">
          <div className="w-16 h-16 rounded-2xl bg-[#1e1e24] flex items-center justify-center mx-auto mb-4 text-[#4fc3f7]">
            <IconServer />
          </div>
          <p className="text-[#8888a0] mb-6">Нет активных конфигураций</p>
          <button onClick={() => setActiveTab('buy')} className="px-6 py-3 bg-[#4fc3f7] hover:bg-[#64b5f6] rounded-xl text-white font-medium transition-colors">
            Купить VPN
          </button>
        </Card>
      ) : (
        configs.map((config) => (
          <Card key={config.id}>
            <div className="flex justify-between items-start mb-4">
              <div>
                <div className="flex items-center gap-2 mb-1">
                  <span className="text-lg font-bold text-white">{config.protocol}</span>
                  <span className="w-2 h-2 rounded-full bg-[#4fc3f7]"></span>
                  <span className="text-[#8888a0] text-sm">{config.status === 'active' ? 'Активен' : 'Просрочен'}</span>
                </div>
                <p className="text-[#8888a0] text-sm">До: {config.expiry}</p>
              </div>
              <span className="text-[#8888a0] bg-[#1e1e24] px-3 py-1 rounded-lg text-xs">
                {config.server}
              </span>
            </div>
            <div className="flex gap-3">
              <button
                onClick={() => handleConnect(config)}
                className="flex-1 py-3 bg-[#4fc3f7] hover:bg-[#64b5f6] rounded-xl text-white font-medium flex items-center justify-center gap-2 transition-colors"
              >
                <IconCheck />
                <span>Подключиться</span>
              </button>
              <button className="flex-1 py-3 bg-[#1e1e24] border border-[#4fc3f7] hover:bg-[#252530] rounded-xl text-[#4fc3f7] font-medium flex items-center justify-center gap-2 transition-colors">
                <IconRefresh />
                <span>Сервер</span>
              </button>
            </div>
          </Card>
        ))
      )}
    </div>
  );

  const renderBuy = () => {
    if (buyStep === 1) {
      return (
        <div className="space-y-4">
          <h2 className="text-xl font-bold text-white mb-4">Тарифы</h2>
          {tariffs.map((tariff) => (
            <Card key={tariff.id}>
              <div className="flex justify-between items-center mb-4">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-[#1e1e24] flex items-center justify-center text-[#4fc3f7]">
                    <IconTariff />
                  </div>
                  <div>
                    <span className="text-lg font-bold text-white">{tariff.days} дней</span>
                    <p className="text-[#8888a0] text-sm">{tariff.speed}</p>
                  </div>
                </div>
                <span className="text-xl font-bold text-[#4fc3f7]">{tariff.price} ₽</span>
              </div>
              <button onClick={() => handleBuy(tariff)} className="w-full py-3 bg-[#4fc3f7] hover:bg-[#64b5f6] rounded-xl text-white font-medium transition-colors">
                Выбрать
              </button>
            </Card>
          ))}
        </div>
      );
    }
    if (buyStep === 2) {
      return (
        <div className="space-y-4">
          <h2 className="text-xl font-bold text-white mb-4">Серверы</h2>
          {servers.map((server) => (
            <Card key={server.id}>
              <div className="flex justify-between items-center mb-4">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-[#1e1e24] flex items-center justify-center text-[#4fc3f7]">
                    <IconServer />
                  </div>
                  <div>
                    <span className="text-lg font-bold text-white">{server.name}</span>
                    <p className="text-[#8888a0] text-sm">{server.country}</p>
                  </div>
                </div>
                <span className="text-[#8888a0] text-sm">{server.latency}</span>
              </div>
              <button onClick={() => handleSelectServer(server)} className="w-full py-3 bg-[#1e1e24] border border-[#4fc3f7] hover:bg-[#252530] rounded-xl text-[#4fc3f7] font-medium transition-colors">
                Выбрать
              </button>
            </Card>
          ))}
        </div>
      );
    }
    return (
      <Card className="text-center py-12">
        <div className="w-20 h-20 bg-[#4fc3f7] rounded-2xl flex items-center justify-center mx-auto mb-6 text-white">
          <IconCheck />
        </div>
        <h2 className="text-xl font-bold text-white mb-2">Заказ создан</h2>
        <p className="text-[#8888a0] mb-6">Оплата в Telegram</p>
        <button className="px-6 py-3 bg-[#4fc3f7] hover:bg-[#64b5f6] rounded-xl text-white font-medium transition-colors">
          Перейти к оплате
        </button>
      </Card>
    );
  };

  const renderProfile = () => (
    <div className="space-y-4">
      <h2 className="text-xl font-bold text-white mb-4">Профиль</h2>
      <Card>
        <div className="space-y-4">
          {[
            { label: 'Баланс', value: '0 ₽', icon: IconBalance },
            { label: 'Реферальный баланс', value: '0 ₽', icon: IconBalance },
            { label: 'Приглашено друзей', value: '0', icon: IconReferral },
            { label: 'Реферальный код', value: 'VPN2026', icon: IconReferral }
          ].map((item, i) => (
            <div key={i} className="flex justify-between items-center py-3 border-b border-[#2a2a32] last:border-0">
              <div className="flex items-center gap-3">
                <div className="w-9 h-9 rounded-xl bg-[#1e1e24] flex items-center justify-center text-[#4fc3f7]">
                  <item.icon />
                </div>
                <span className="text-[#8888a0]">{item.label}</span>
              </div>
              {item.value.includes('VPN') ? (
                <span className="text-lg font-bold text-[#4fc3f7]">{item.value}</span>
              ) : (
                <span className="text-lg font-bold text-white">{item.value}</span>
              )}
            </div>
          ))}
        </div>
      </Card>
      <Card>
        <h3 className="text-lg font-bold text-white mb-4">Статистика</h3>
        <div className="grid grid-cols-2 gap-3">
          <div className="text-center p-4 bg-[#1e1e24] rounded-xl">
            <div className="text-2xl font-bold text-[#4fc3f7]">12</div>
            <div className="text-[#8888a0] text-xs mt-1">дней онлайн</div>
          </div>
          <div className="text-center p-4 bg-[#1e1e24] rounded-xl">
            <div className="text-2xl font-bold text-[#4fc3f7]">8.2</div>
            <div className="text-[#8888a0] text-xs mt-1">ГБ трафика</div>
          </div>
        </div>
      </Card>
    </div>
  );

  const renderDeviceSelection = () => (
    <div className="fixed inset-0 bg-[#0d0d0f] z-50 flex flex-col">
      <div className="p-6 flex-1">
        <h2 className="text-xl font-bold text-white mb-8 text-center">Какое устройство вы используете?</h2>
        <div className="space-y-4">
          {deviceOptions.map((option) => (
            <button
              key={option.id}
              onClick={() => {
                setDevice(option.id);
                setShowDeviceSelection(false);
              }}
              className={`w-full py-5 rounded-2xl border-2 transition-all flex items-center justify-center gap-4 ${
                device === option.id
                  ? 'border-[#4fc3f7] bg-[#16161a] shadow-[0_0_24px_rgba(79,195,247,0.25)]'
                  : 'border-[#2a2a32] bg-[#16161a] hover:bg-[#1e1e24]'
              }`}
            >
              <div className="w-14 h-14 rounded-xl bg-[#1e1e24] flex items-center justify-center text-[#4fc3f7]">
                <IconDevice type={option.icon} size={28} />
              </div>
              <span className="text-lg font-medium text-white">{option.name}</span>
            </button>
          ))}
        </div>
      </div>
      <button
        onClick={() => setShowDeviceSelection(false)}
        className="w-full py-4 bg-[#16161a] hover:bg-[#1e1e24] border-t border-[#2a2a32] text-[#e0e0e8] transition-colors"
      >
        Назад
      </button>
    </div>
  );

  return (
    <div className="min-h-screen bg-[#0d0d0f] text-white font-sans">
      <div className="pt-8 pb-24 px-4 max-w-md mx-auto">
        {showDeviceSelection ? renderDeviceSelection() :
         activeTab === 'home' ? renderHome() :
         activeTab === 'configs' ? renderConfigs() :
         activeTab === 'buy' ? renderBuy() :
         renderProfile()}
      </div>

      <div className="fixed bottom-0 left-0 right-0 bg-[#16161a] border-t border-[#2a2a32]">
        <div className="flex justify-around items-center py-3 px-4 max-w-md mx-auto">
          {[
            { id: 'home', label: 'Главная', icon: () => (
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M12 2L2 12h3v8h6v-6h2v6h6v-8h3L12 2z" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
              </svg>
            )},
            { id: 'configs', label: 'Конфиги', icon: IconServer },
            { id: 'buy', label: 'Купить', icon: IconTariff },
            { id: 'profile', label: 'Профиль', icon: IconReferral }
          ].map((tab) => (
            <button
              key={tab.id}
              onClick={() => {
                setActiveTab(tab.id);
                if (tab.id === 'buy') setBuyStep(1);
              }}
              className={`flex flex-col items-center py-2 px-3 rounded-xl transition-all ${
                activeTab === tab.id ? 'text-[#4fc3f7]' : 'text-[#8888a0] hover:text-white'
              }`}
            >
              <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${
                activeTab === tab.id ? 'bg-[#1e1e24]' : ''
              }`}>
                <tab.icon />
              </div>
              <span className="text-xs font-medium mt-1">{tab.label}</span>
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};

export default App;
